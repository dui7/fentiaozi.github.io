(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{417:function(s,a,n){"use strict";n.r(a);var e=n(17),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"测试容器化-go-应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试容器化-go-应用"}},[s._v("#")]),s._v(" 测试容器化 GO 应用")]),s._v(" "),n("p",[s._v("Golang 作为服务器端新兴热门语言同时也是容器技术的主要编写语言备受关注；它简洁、有趣、并行、安全等特点让 GO 应用容器化相对省心；一般来说做下时间本地化、安装信任根证书，然后把编译生成的二进制拷贝进去即可。")]),s._v(" "),n("h2",{attrs:{id:"一个演示-go-web-应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一个演示-go-web-应用"}},[s._v("#")]),s._v(" 一个演示 GO WEB 应用")]),s._v(" "),n("p",[n("a",{attrs:{href:"hellogo.go"}},[s._v("hellogo 代码")])]),s._v(" "),n("h2",{attrs:{id:"dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),n("p",[s._v("作为演示项目的Dockerfile比较简单，请看 "),n("a",{attrs:{href:"Dockerfile"}},[s._v("Dockerfile 文件")])]),s._v(" "),n("ul",[n("li",[s._v("采用 docker 多阶段编译，使生成的目标镜像最小")]),s._v(" "),n("li",[s._v("使用 alpine 基础镜像")]),s._v(" "),n("li",[s._v("安装 tzdata 做时间本地化")]),s._v(" "),n("li",[s._v("安装信任根证书")])]),s._v(" "),n("p",[s._v("一个真实复杂go项目的Dockerfile可能如这个例子："),n("a",{attrs:{href:"Dockerfile-more"}},[s._v("复杂 Dockerfile")])]),s._v(" "),n("h2",{attrs:{id:"制作镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#制作镜像"}},[s._v("#")]),s._v(" 制作镜像")]),s._v(" "),n("p",[s._v("在 Dockerfile 文件所在目录，执行")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker build -t hellogo:v1.0 .\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"本地测试应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本地测试应用"}},[s._v("#")]),s._v(" 本地测试应用")]),s._v(" "),n("ul",[n("li",[s._v("1.单机运行 hellogo 容器应用")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker run -d --name hello -p3000:3000 hellogo:v1.0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("2.验证测试")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看本地监听端口")]),s._v("\n$ ss -ntl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\nLISTEN   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("                       *:3000                   *:*\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看应用状态")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:3000\nHello, Go"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" I'm instance "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("987")]),s._v(" running version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13109")]),s._v("-10-13 08:39:11\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:3000/health -i\nHTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nDate: Sun, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" Oct "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" 00:39:15 GMT\nContent-Length: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:3000/version\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"在-k8s-上运行演示应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在-k8s-上运行演示应用"}},[s._v("#")]),s._v(" 在 k8s 上运行演示应用")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("可以参考项目"),n("code",[s._v("github.com/easzlab/kubeasz")]),s._v(" 快速搭建一个本地 k8s 测试环境")])]),s._v(" "),n("li",[n("p",[s._v("1.编写基于k8s的应用编排文件 "),n("a",{attrs:{href:"hellogo.yaml"}},[s._v("hellogo.yaml")])]),s._v(" "),n("ul",[n("li",[s._v("设置应用副本数"),n("code",[s._v("replicas: 3")])]),s._v(" "),n("li",[s._v("预设新副本启动延迟5秒"),n("code",[s._v("minReadySeconds: 5")])]),s._v(" "),n("li",[s._v("设置滚动更新策略")]),s._v(" "),n("li",[s._v("设置资源使用限制，安装实际情况修改")]),s._v(" "),n("li",[s._v("设置服务对外暴露方式 NodePort，根据实际情况修改端口，或者使用 ingress 方式")])])]),s._v(" "),n("li",[n("p",[s._v("2.在 k8s 上运行应用")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行")]),s._v("\n$ kubectl apply -f hellogo.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n$ kubectl get pod\nNAME                             READY   STATUS    RESTARTS   AGE\nhellogo-deploy-854dcd85c-2zm9l   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nhellogo-deploy-854dcd85c-7nfk5   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nhellogo-deploy-854dcd85c-ns7fp   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\n\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$kubectl")]),s._v(" get deploy\nNAME             READY   UP-TO-DATE   AVAILABLE   AGE\nhellogo-deploy   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("           13m\n\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$kubectl")]),s._v(" get svc\nNAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nhellogo-svc   NodePort    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.68")]),s._v(".194.109   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":30000/TCP   13m\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用curl测试应用三副本状态（用curl多次访问看到三个不同`instance id`）")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.2.173:30000\nHello, Go"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" I"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'m instance 629 running version 1.2 at 13109-10-13 09:06:25\n\n$ curl http://192.168.2.173:30000\nHello, Go! I'")]),s._v("m instance "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("722")]),s._v(" running version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13109")]),s._v("-10-13 09:06:27\n\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$curl")]),s._v(" http://192.168.2.173:30000\nHello, Go"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" I'm instance "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("799")]),s._v(" running version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13109")]),s._v("-10-13 09:06:28\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);